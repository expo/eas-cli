#!/usr/bin/env bash

source_up

access_secret_version() {
  name="$1"
  version="$2"
  gcloud secrets versions access "$version" --secret "$name" --project exponentjs
}

source_secrets_from_gcsm_json() {
  name="$1"
  version="$2"

  secrets=$(access_secret_version "$name" "$version")
  eval "export $(echo "$secrets" | jq -r 'to_entries | map("\(.key)=\(.value)") | @sh')"
}

source_secrets_from_gcsm_json "turtle_v2__worker_tests" 5
